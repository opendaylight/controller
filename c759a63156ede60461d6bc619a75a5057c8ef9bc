{
  "comments": [
    {
      "key": {
        "uuid": "1a622d24_b0f2136d",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/test/java/org/opendaylight/controller/cluster/raft/behaviors/FollowerTest.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 5706
      },
      "writtenOn": "2017-01-04T10:42:14Z",
      "side": 1,
      "message": "The new added case of \"testCaptureSnapshotOnAppendEntries\" only tests the last entry in AppendEntries will trigger capturing snapshot. Please add a case that tests a not-last entry in AppendEntries will trigger capturing snapshot. I doubt whether that case can produce correct snapshot.",
      "revId": "c759a63156ede60461d6bc619a75a5057c8ef9bc",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a622d24_c461d13a",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/test/java/org/opendaylight/controller/cluster/raft/behaviors/FollowerTest.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1842
      },
      "writtenOn": "2017-01-05T01:14:51Z",
      "side": 1,
      "message": "I added more test cases. It does actually work if the next to last entry triggers the snapshot but the persisted Snapshot isn\u0027t technically correct. The lastIndex doesn\u0027t reflect the last index that\u0027s actually included in the snapshotted state.  However we don\u0027t actually use the lastIndex so it doesn\u0027t matter. That said, it is still incorrect and should be corrected. Also the applied entries after the triggering entry don\u0027t get purged from the persisted log b/c they haven\u0027t been persisted yet. On recovery, it would attempt to append them but would fail with a log message.\n\nI made some modifications to the appendAndPersist callback in Follower#handleAppendEntries to alleviate these issues (see code comments).",
      "parentUuid": "1a622d24_b0f2136d",
      "revId": "c759a63156ede60461d6bc619a75a5057c8ef9bc",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}