{
  "comments": [
    {
      "key": {
        "uuid": "7a96c907_cdcb2071",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "It seems this is only used in the ReplicatedLogImpl class - can we move it there?.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_b0206b4a",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 116,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "will change",
      "parentUuid": "7a96c907_cdcb2071",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_8dbbd80d",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 437,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "Does this need to be info? Seems like this would get logged a lot so should be debug.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_d01df710",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 437,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "will change to debug",
      "parentUuid": "7a96c907_8dbbd80d",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_ed413c0c",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 759,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "We\u0027re calling replicatedLogEntry.size() twice here. To optimize we should call it once and put in a local var.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_30d45b1f",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 759,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "won\u0027t probably save much because the underlying datasize is actually cached but I will make this change.",
      "parentUuid": "7a96c907_ed413c0c",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_4d32b0a8",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "I assume the exact number 5 is a heuristic? \n\nI think I get the logic here. We won\u0027t be snapshotting the persistent log as often based on data size b/c the only reason we snapshot for this reason is to reduce the in memory log size. Technically we could eliminate  snapshotting based on size altogether in this case but it shouldn\u0027t hurt to still snapshot but at a lower rate. Is that correct?",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_50d9e755",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "Yes you understood right. Basically now I can wait for the dataSize to get 5 times as much as normal before I do a real snapshot. I\u0027ll move the 5 to a constant.",
      "parentUuid": "7a96c907_4d32b0a8",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_cde4800f",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 783,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "In the prior code, we used journal.size() for the check here, which is the size of journal List itself.  Now we\u0027re using \"lastIndex() + 1\" (set to journalSize above). I understand this for the \"no follower case\" b/c the actual journal List should always be empty so we can\u0027t use size(). Is \"lastIndex() + 1\" equivalent  to size()? I just want to ensure that the previous behavior is maintained for the case when there are followers.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_b0e70b12",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 783,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "lastIndex() + 1 \u003d full journal size\nsize() \u003d in-memory journal size\n\nSo they are not the same. However as far as the logic is concerned the old behavior will be retained because we are doing a modulo. \n\nSo let\u0027s say I had never snapshotted then lastIndex + 1 \u003d size\nIf I snapshotted once and snapshot batch count was 100 then lastindex + 1 \u003d size + 100 and so the modulo will work the same way.",
      "parentUuid": "7a96c907_cde4800f",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_edb4dcf3",
        "filename": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/RaftActor.java",
        "patchSetId": 1
      },
      "lineNbr": 800,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "I assume when !hasFollowers(), then lastAppliedEntry will be null. Even so, we\u0027re  overwriting lastAppliedIndex and lastAppliedTerm regardless. Can we rewrite this to make to more clear, i.e.:\n\nReplicatedLogEntry lastAppliedEntry \u003d get(context.getLastApplied());\nif(!hasFollowers()) {\n    ...\n} else if (lastAppliedEntry !\u003d null) {\n    ...\n}",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_cd924057",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/main/java/org/opendaylight/controller/cluster/datastore/Shard.java",
        "patchSetId": 1
      },
      "lineNbr": 328,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "Perhaps the updateJournalStats() call could be moved to applyModificationToState?  Currently it\u0027s called by applyState after it calls applyModificationToState.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_90ee8feb",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/main/java/org/opendaylight/controller/cluster/datastore/Shard.java",
        "patchSetId": 1
      },
      "lineNbr": 328,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "When I think about it updateJournalStats is not needed at all in this case. There will be nothing ever in the journal in this scenario (I mean I am not even adding the modification to the journal in this case)",
      "parentUuid": "7a96c907_cd924057",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_d03c1732",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/main/java/org/opendaylight/controller/cluster/datastore/Shard.java",
        "patchSetId": 1
      },
      "lineNbr": 328,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T21:14:04Z",
      "side": 1,
      "message": "Yes - I realized that too",
      "parentUuid": "7a96c907_90ee8feb",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_ad7c9421",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/datastore/ShardTest.java",
        "patchSetId": 1
      },
      "lineNbr": 949,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T15:42:45Z",
      "side": 1,
      "message": "I assume you were planning on getting this test to work in a follow-up patch? I guess we need RaftActor to think it has followers. I could work on this if you want.",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_102cbf46",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/datastore/ShardTest.java",
        "patchSetId": 1
      },
      "lineNbr": 949,
      "author": {
        "id": 795
      },
      "writtenOn": "2015-01-07T19:55:06Z",
      "side": 1,
      "message": "I was thinking of doing this in a follow-up patch yes.",
      "parentUuid": "7a96c907_ad7c9421",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_704983cf",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/datastore/ShardTest.java",
        "patchSetId": 1
      },
      "lineNbr": 949,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T21:14:04Z",
      "side": 1,
      "message": "I got this test working - I can submit in a follow-up patch.",
      "parentUuid": "7a96c907_102cbf46",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a96c907_501807d3",
        "filename": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/datastore/ShardTest.java",
        "patchSetId": 1
      },
      "lineNbr": 949,
      "author": {
        "id": 1842
      },
      "writtenOn": "2015-01-07T21:15:07Z",
      "side": 1,
      "message": "I also added a test with persistence disabled to cover that code branch.",
      "parentUuid": "7a96c907_704983cf",
      "revId": "ab31ae804174ada096429bfb791377d852d14ab4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}